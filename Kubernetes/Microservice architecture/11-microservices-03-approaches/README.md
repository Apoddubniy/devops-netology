## Ответ на домашнее задание к 11-02 «Микросервисы: подходы»  

### Задача 1: Обеспечить разработку

---
Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

* облачная система;
* система контроля версий Git;
* репозиторий на каждый сервис;
* запуск сборки по событию из системы контроля версий;
* запуск сборки по кнопке с указанием параметров;
* возможность привязать настройки к каждой сборке;
* возможность создания шаблонов для различных конфигураций сборок;
* возможность безопасного хранения секретных данных (пароли, ключи доступа);
* несколько конфигураций для сборки из одного репозитория;
* кастомные шаги при сборке;
* собственные докер-образы для сборки проектов;
* возможность развернуть агентов сборки на собственных серверах;
* возможность параллельного запуска нескольких сборок;
* возможность параллельного запуска тестов.

Обоснуйте свой выбор.

### Ответ:

Облачные сервисы обычно содержат все необходимые компоненты для построения CI/CD.  
Пример: AWS Codepipeline, Azure DevOps, Google Cloud Build и Yandex Cloud и другие.  
В облачных сервисах из примера, можно скомбинировать и container registry и VCS.  
Из CI/CD as a Service, можно выделить gitlab, github/github actions. Наиболее подходящим решениями будут gitlab SaaS или github,
реализующие все заявленные функции.  
В зависимости от требований к хранению секретов может потребоваться дополнительный сервис, например Hashicorp Vault, Yandex Lockbox и другие.

### Задача 2: Логи

---

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре. Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

* сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
* минимальные требования к приложениям, сбор логов из stdout;
* гарантированная доставка логов до центрального хранилища;
* обеспечение поиска и фильтрации по записям логов;
* обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
* возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.

### Ответ:

1. Loki для сбора и хранения, Grafana для поиска и отображения, и Promtail в качестве агента-сборщика.
2. Elasticsearch для хранения, Logstash или Logstash+Kafka в качестве коллектора, Beats/Fluentd в качестве сборщиков, Kibana в качестве UI для поиска и управления.
3. Clickhouse для хранения логов , Vektor в качестве агента, Light-house либо Redash для UI.

Второй вариант наиболее, универсальный под любые проекты. Но необходимо учитывать и специфику проекта для выбора ПО сбора и отображения логов.

### Задача 3: Мониторинг

---
Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре. Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

* сбор метрик со всех хостов, обслуживающих систему;
* сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
* сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
* сбор метрик, специфичных для каждого сервиса;
* пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
* пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

Обоснуйте свой выбор.

### Ответ:

Данное решение это prometheus. Контейнерная платформа kubernetes поддерживает service discovery и выдачу метрик в формате prometheus,
а для сбора метрик с хостов и сервисов, не поддерживающих работу с prometheus, существуют экспортеры, в частности node_exporter для сбора метрик с хостов.
В качестве пользовательского интерфейса используется grafana, а в качестве долговременного хранилища можно использовать victoria metrics.